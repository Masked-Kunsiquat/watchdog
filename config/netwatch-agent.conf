# Netwatch Agent Configuration
#
# This file is sourced by netwatch-agent.sh and should contain only
# KEY=VALUE pairs. It will be installed to /etc/default/netwatch-agent
# with permissions 0640 (root:root).
#

# Space-separated IP addresses to probe for WAN connectivity
# Use IPs (not DNS names) to avoid resolver coupling
TARGETS="1.1.1.1 8.8.8.8 9.9.9.9"

# Minimum number of targets that must respond per check to consider WAN up
MIN_OK=1

# Number of ICMP echo requests per target
PING_COUNT=1

# Timeout in seconds for each ping probe
PING_TIMEOUT=1

# Seconds between health check loops
CHECK_INTERVAL=10

# Continuous outage duration (seconds) before triggering reboot
# Default: 600s (10 minutes)
DOWN_WINDOW_SECONDS=600

# Grace period after boot before monitoring starts (seconds)
# Prevents premature reboots during system startup
BOOT_GRACE=180

# Minimum seconds between reboots (prevents boot loops)
# Default: 1200s (20 minutes)
COOLDOWN_SECONDS=1200

# Probe method: auto (prefer fping), yes (require fping), no (force ping)
USE_FPING="auto"

# Dry-run mode: 1 = log only (no reboot), 0 = normal operation
DRY_RUN=0

# If this file exists, the watchdog pauses (no reboots)
DISABLE_FILE="/etc/netwatch-agent.disable"

#
# Webhook Notifications (optional)
#
# Enable webhook notifications: 1 = enabled, 0 = disabled
WEBHOOK_ENABLED=0

# Webhook URL to POST notifications to
#WEBHOOK_URL="https://ntfy.sh/my-topic"

# HTTP method (default: POST)
#WEBHOOK_METHOD="POST"

# Comma-separated list of events to notify: down,recovery,reboot,startup,health
# Default: all events
# - down: WAN connectivity lost
# - recovery: WAN connectivity restored
# - reboot: System about to reboot due to outage
# - startup: Service started after system boot (sent if uptime < 10 minutes)
# - health: Periodic health report with metrics
#WEBHOOK_EVENTS="down,recovery,reboot,startup,health"

# Timeout for webhook requests in seconds
#WEBHOOK_TIMEOUT=10

# Interval for health reports in seconds (default: 86400 = 24 hours)
# Set to 0 to disable health reports
#WEBHOOK_HEALTH_INTERVAL=86400

# Custom HTTP headers (semicolon-separated)
# Examples:
#   Discord: WEBHOOK_HEADERS="Content-Type: application/json"
#   Ntfy with auth: WEBHOOK_HEADERS="Authorization: Bearer tk_..."
#   Apprise: WEBHOOK_HEADERS="Content-Type: application/json"
#WEBHOOK_HEADERS=""

# Custom body template with variable substitution
# Available variables:
#   {EVENT} - Event type (down, recovery, reboot, startup, health)
#   {MESSAGE} - Human-readable event message
#   {HOSTNAME} - System hostname
#   {TIMESTAMP} - ISO 8601 timestamp (UTC)
#   {DURATION} - Event duration in seconds
#   {TARGETS} - Configured ICMP target IPs
#   {DOWN_WINDOW} - Configured outage threshold
#   {UPTIME} - System uptime in seconds
#   {TOTAL_REBOOTS} - Total reboots initiated by netwatch
#   {TOTAL_OUTAGES} - Total WAN outages detected
#   {TOTAL_RECOVERIES} - Total WAN recoveries
#   {TOTAL_DOWNTIME} - Total downtime in seconds
#   {SERVICE_RUNTIME} - Service runtime in seconds
#
# Default (if not set):
#   Regular events: {"event":"{EVENT}","message":"{MESSAGE}","hostname":"{HOSTNAME}","timestamp":"{TIMESTAMP}","duration":{DURATION},"targets":"{TARGETS}"}
#   Startup/health: {"event":"{EVENT}","message":"{MESSAGE}","hostname":"{HOSTNAME}","timestamp":"{TIMESTAMP}","uptime":{UPTIME},"metrics":{...}}
#
# Example for ntfy.sh (simple text):
#   WEBHOOK_BODY_TEMPLATE="{MESSAGE}"
#
# Example for Discord webhook:
#   WEBHOOK_BODY_TEMPLATE='{"content":"**{HOSTNAME}**: {MESSAGE}","embeds":[{"title":"Netwatch Alert","description":"{MESSAGE}","color":15158332,"fields":[{"name":"Event","value":"{EVENT}","inline":true},{"name":"Duration","value":"{DURATION}s","inline":true}],"timestamp":"{TIMESTAMP}"}]}'
#
# Example for Gotify:
#   WEBHOOK_BODY_TEMPLATE='{"title":"Netwatch {EVENT}","message":"{MESSAGE}","priority":8}'
#
# Example for Apprise (generic):
#   WEBHOOK_BODY_TEMPLATE='{"title":"Netwatch Alert","body":"{MESSAGE}","type":"warning"}'
#
#WEBHOOK_BODY_TEMPLATE=""

#
# Quick Setup Examples
#

# Ntfy.sh (simple):
#   WEBHOOK_ENABLED=1
#   WEBHOOK_URL="https://ntfy.sh/my-unique-topic"
#   WEBHOOK_BODY_TEMPLATE="{HOSTNAME}: {MESSAGE}"

# Discord webhook:
#   WEBHOOK_ENABLED=1
#   WEBHOOK_URL="https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN"
#   WEBHOOK_BODY_TEMPLATE='{"content":"**{HOSTNAME}**: {MESSAGE}"}'

# Gotify:
#   WEBHOOK_ENABLED=1
#   WEBHOOK_URL="https://gotify.example.com/message?token=YOUR_TOKEN"
#   WEBHOOK_BODY_TEMPLATE='{"title":"Netwatch {EVENT}","message":"{MESSAGE}","priority":8}'

# Notifiarr:
#   WEBHOOK_ENABLED=1
#   WEBHOOK_URL="https://notifiarr.com/api/v1/notification/netwatch"
#   WEBHOOK_HEADERS="X-API-Key: your_api_key_here"

# Apprise API:
#   WEBHOOK_ENABLED=1
#   WEBHOOK_URL="http://apprise.example.com:8000/notify"
#   WEBHOOK_BODY_TEMPLATE='{"urls":["discord://webhook_id/webhook_token"],"title":"Netwatch {EVENT}","body":"{MESSAGE}"}'
